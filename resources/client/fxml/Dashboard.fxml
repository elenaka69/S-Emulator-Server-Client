<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.TextArea?>
<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="client.DashboardController"
            stylesheets="@/client/css/style.css"
            styleClass="root">

    <!-- Top: App title -->

    <top>
        <VBox spacing="10" alignment="TOP_CENTER" style="-fx-padding: 10;" fillWidth="true">
            <!-- Title Label (centered) -->
            <Label text="S-Emulator Dashboard" styleClass="title"/>

            <!-- Username (aligned left) -->
            <HBox alignment="CENTER_LEFT" style="-fx-padding: 0 0 0 10;" fillHeight="true">
                <Label fx:id="usernameField" text="" styleClass="section-label"/>
            </HBox>

            <!-- File selection + Load -->
            <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 0 0 0 10;">
                <Button fx:id="loadButton" text="Load..." onAction="#onLoadFile"/>
                <TextField fx:id="filePathField" promptText="Selected file path" prefWidth="380"/>
                <Region HBox.hgrow="ALWAYS"/>

                <!-- Available Credits -->
                <Label text="Available Credits:"/>
                <TextField fx:id="creditsField" prefWidth="80" editable="false"/>
                <Button text="Charge Credits" onAction="#onChargeCredits"/>
                <TextField fx:id="chargeAmountField" prefWidth="80"/>
            </HBox>
            <HBox alignment="CENTER_LEFT" style="-fx-padding: 0 0 0 0;">
                <ProgressBar fx:id="progressBar" prefHeight="20" prefWidth="465" progress="0.0" style="-fx-padding: 0 0 0 10;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button fx:id="chatButton" text="Chat" onAction="#onToggleChat"/>
            </HBox>
            </VBox>
        </top>


        <center>
            <ScrollPane fitToWidth="true" fitToHeight="true" style="-fx-padding: 0 10 10 0;">
                <content>
                    <VBox spacing="10" alignment="TOP_CENTER">
                    <!-- Users / Programs modules side-by-side -->
                    <HBox fx:id="dashboardMainContentBox" spacing="10" alignment="TOP_LEFT"
                              style="-fx-padding: 0 0 0 20;" HBox.hgrow="ALWAYS">
                <!-- Users Module -->
                    <TitledPane text="Users" collapsible="false" HBox.hgrow="ALWAYS" >
                        <VBox spacing="10" alignment="TOP_CENTER" fillWidth="true" style="-fx-padding: 10;">

                            <!-- Connected Users Table -->
                            <Label text="Available Users" styleClass="section-label" alignment="TOP_CENTER"/>
                            <VBox spacing="5" alignment="CENTER" fillWidth="false">
                                <TableView fx:id="connectedUsersTable" prefHeight="300" VBox.vgrow="ALWAYS"
                                           style="-fx-border-color: gray; -fx-border-width: 2; -fx-border-radius: 5;"
                                           prefWidth="400">
                                    <columns>
                                        <TableColumn text="#" prefWidth="30" fx:id="colNumber"/>
                                        <TableColumn text="Username" prefWidth="120" fx:id="colUsername"/>
                                        <TableColumn text="#Prog" prefWidth="50" fx:id="colUpProg"/>
                                        <TableColumn text="#Funcs" prefWidth="50" fx:id="colUpFuncs"/>
                                        <TableColumn text="Credits" prefWidth="50" fx:id="colBalance"/>
                                        <TableColumn text="Spent" prefWidth="50" fx:id="colSpentCredits"/>
                                        <TableColumn text="Exec" prefWidth="50" fx:id="colNumExecutions"/>
                                    </columns>
                                </TableView>
                            </VBox>
                            <Button text="Unselect User" onAction="#onUnselectUser"/>
                            <!-- Statistics Table -->
                            <Label text="Statistics" styleClass="section-label" alignment="TOP_CENTER"/>
                            <VBox spacing="5" alignment="CENTER" fillWidth="false">
                                <TableView fx:id="statisticTable" prefHeight="300" VBox.vgrow="ALWAYS"
                                           style="-fx-border-color: gray; -fx-border-width: 2; -fx-border-radius: 5;"
                                           prefWidth="400">
                                    <columns>
                                        <TableColumn text="#" prefWidth="30" fx:id="colStatNumber"/>
                                        <TableColumn text="Type" prefWidth="60" fx:id="colStatType"/>
                                        <TableColumn text="Name" prefWidth="110" fx:id="colStatName"/>
                                        <TableColumn text="Arch" prefWidth="50" fx:id="colStatArch"/>
                                        <TableColumn text="Degree" prefWidth="50" fx:id="colStatDegree"/>
                                        <TableColumn text="Result" prefWidth="50" fx:id="colStatResult"/>
                                        <TableColumn text="Cycles" prefWidth="50" fx:id="colStatCycles"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </VBox>
                    </TitledPane>
                    <!-- Programs Module -->
                    <TitledPane text="Programs" collapsible="false" prefWidth="550" HBox.hgrow="ALWAYS">
                        <VBox spacing="10" alignment="TOP_CENTER" fillWidth="true" style="-fx-padding: 10;">

                            <!-- Loaded Programs Table -->
                            <Label text="Available programs" styleClass="section-label" alignment="TOP_CENTER"/>
                            <VBox spacing="5" alignment="CENTER" fillWidth="false">
                                <TableView fx:id="programsTable" prefHeight="300" VBox.vgrow="ALWAYS"
                                           style="-fx-border-color: gray; -fx-border-width: 2; -fx-border-radius: 5;"
                                           prefWidth="400">
                                    <columns>
                                        <TableColumn text="#" prefWidth="30" fx:id="colProgNumber"/>
                                        <TableColumn text="Name" prefWidth="85" fx:id="colProgramName"/>
                                        <TableColumn text="User" prefWidth="80" fx:id="colProgramUserName"/>
                                        <TableColumn text="#Inst" prefWidth="50" fx:id="colProgramNumInstr"/>
                                        <TableColumn text="Max&#10;Cost" prefWidth="50" fx:id="colProgMaxCost"/>
                                        <TableColumn text="#Exec" prefWidth="50" fx:id="colProgramNumExec"/>
                                        <TableColumn text="Aver&#10;Cost" prefWidth="50" fx:id="colProgramAverCost"/>
                                    </columns>
                                </TableView>
                            </VBox>
                            <Button text="Execute Program" onAction="#onExecuteProgram"/>
                            <!-- Loaded Functions Table -->
                            <Label text="Available functions" styleClass="section-label" alignment="TOP_CENTER"/>
                            <VBox spacing="5" alignment="CENTER" fillWidth="false">
                                <TableView fx:id="functionsTable" prefHeight="300" VBox.vgrow="ALWAYS"
                                           style="-fx-border-color: gray; -fx-border-width: 2; -fx-border-radius: 5;"
                                           prefWidth="400">
                                    <columns>
                                        <TableColumn text="#" prefWidth="30" fx:id="colFuncNumber"/>
                                        <TableColumn text="Name" prefWidth="85" fx:id="colFuncamName"/>
                                        <TableColumn text="Program" prefWidth="100" fx:id="colFuncamProgram"/>
                                        <TableColumn text="User" prefWidth="80" fx:id="colPFuncUserName"/>
                                        <TableColumn text="#Inst" prefWidth="50" fx:id="colFuncNumInstr"/>
                                        <TableColumn text="Max&#10;Cost" prefWidth="50" fx:id="colFuncMaxCost"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </VBox>
                    </TitledPane>
                    <TitledPane fx:id="chatPane" text="Chat" collapsible="false" prefWidth="400" visible="false" managed="false">
                        <VBox spacing="10" alignment="TOP_CENTER" fillWidth="true" style="-fx-padding: 10;">
                            <ScrollPane fx:id="chatScrollPane" fitToWidth="true" prefHeight="300" prefWidth="400">
                                <content>
                                    <VBox fx:id="chatBox" spacing="5" alignment="TOP_CENTER" style="-fx-padding: 10;"/>
                                </content>
                            </ScrollPane>
                            <HBox spacing="5">
                                <TextField fx:id="chatInput" promptText="Type your message..." HBox.hgrow="ALWAYS"/>
                                <Button text="Send" onAction="#onSendMessage"/>
                            </HBox>
                        </VBox>
                    </TitledPane>
                </HBox>
                </VBox>
            </content>
        </ScrollPane>
    </center>

    <!-- Bottom: Status bar -->
    <bottom>
        <Label fx:id="statusBar" text="Ready." styleClass="section-label" style="-fx-padding:10;"/>
    </bottom>

</BorderPane>
